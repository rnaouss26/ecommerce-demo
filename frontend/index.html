<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Products</title>
  <style>
    body{font-family:system-ui,Arial;margin:24px}
    header{display:flex;justify-content:space-between;align-items:center}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:16px}
    .card{border:1px solid #ddd;border-radius:12px;padding:12px}
    img{width:100%;height:140px;object-fit:cover;border-radius:10px;background:#f6f6f6}
    button{padding:8px 10px;border:1px solid #ccc;border-radius:10px;background:#fff;cursor:pointer}
    a{color:#6a2ccf;text-decoration:none}
  </style>
</head>
<body>
<header>
  <h1>ðŸ›’ Products</h1>
  <a href="cart.html">View cart</a>
</header>

<div id="status">Loading...</div>
<div class="grid" id="grid"></div>

<script>
  const API_BASE = "https://alb-ms93.onrender.com"; // your ALB

  function getCart(){
    try { return JSON.parse(localStorage.getItem("cart") || "[]"); }
    catch(e){ return []; }
  }
  function setCart(cart){ localStorage.setItem("cart", JSON.stringify(cart)); }

  function addToCart(p){
    const cart = getCart();
    const found = cart.find(i => i.id === p.id);
    if(found) found.qty += 1;
    else cart.push({ id: p.id, name: p.name, price: p.price, qty: 1 });
    setCart(cart);
    alert("Added to cart");
  }

  fetch(`${API_BASE}/api/products`)
    .then(r => r.json())
    .then(products => {
      document.getElementById("status").textContent = "";
      const grid = document.getElementById("grid");
      if(!products.length){
        document.getElementById("status").textContent = "No products found.";
        return;
      }
      products.forEach(p => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <img src="${p.imageUrl || ""}" alt="">
          <h3>${p.name}</h3>
          <p>${p.description || ""}</p>
          <p><b>$${Number(p.price).toFixed(2)}</b> â€” stock: ${p.stock}</p>
          <button>Add to cart</button>
        `;
        div.querySelector("button").onclick = () => addToCart(p);
        grid.appendChild(div);
      });
    })
    .catch(err => {
      document.getElementById("status").textContent = "Error loading products.";
      console.error(err);
    });
</script>
</body>
</html>
